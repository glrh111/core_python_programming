# 多线程编程

## 简介/动机

multithreaded MT

## 线程和进程

### 进程

进程(重量级进程)是一个执行中的程序. 每个进程都拥有自己的地址空间, 内存, 数据栈, 以及其他用于跟踪执行的辅助数据.

进程间通过IPC的方式共享信息.

### 线程

线程(轻量级进程)在同一个进程下执行, 共享相同的上下文.

线程包括开始, 执行顺序, 结束三部分. 当其他线程运行时, 它可以被抢占(中断), 或者临时挂起(睡眠), 称为yield 让步.

一个进程中的各个线程与主线程共享同一片数据空间, 线程间通信和信息共享更容易. 线程一般是以并发方式执行的. 

竞态条件: race condition 多个线程访问同一片数据, 由于访问顺序不一样, 引起的结果差异.

## 线程和Python

Python代码的执行, 是由Python虚拟机(解释器主循环)进行控制的. 

主循环中同时只能由一个控制线程在执行.

对Python虚拟机的访问是由全局解释器锁(GIL)控制的. 这个锁用来保证同时只有一个线程运行, 流程如下:
1. 设置GIL
2. 切换进一个线程去执行
3. 执行下面操作之一:
   + 指定数量的字节码指令
   + 线程主动让出控制权(可以调用time.sleep(0))
4. 把线程设置为睡眠状态(切换出线程)
5. 解锁GIL
5. GOTO 1.

### 退出线程


### Python中的线程

thread







